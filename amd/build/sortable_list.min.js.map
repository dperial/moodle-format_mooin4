{"version":3,"sources":["../src/sortable_list.js"],"names":["define","$","log","autoScroll","str","ModalFactory","ModalEvents","Notification","defaultParameters","targetListSelector","moveHandlerSelector","isHorizontal","CSS","keyboardDragClass","isDraggedClass","currentPositionClass","sourceListClass","targetListClass","overElementClass","event","special","touchstart","setup","_","ns","handle","includes","addEventListener","passive","SortableList","root","config","info","proxy","proxyDelta","dragCounter","lastEvent","moved","extend","listSelector","on","dragStartHandler","clickHandler","EVENTS","DRAGSTART","DRAG","DROP","DRAGEND","prototype","resetDraggedClasses","classes","i","removeClass","remove","calculatePositionOnPage","evt","originalEvent","touches","touch","pageX","pageY","clientX","Math","round","window","scrollLeft","clientY","scrollTop","type","moveElement","sourceList","sourceNextElement","finishDragging","which","movedElement","target","closest","currentTarget","children","length","stopPropagation","preventDefault","element","next","parent","targetNextElement","targetList","dropped","startX","startY","startTime","Date","getTime","addClass","offset","x","left","y","top","thisDragCounter","setTimeout","createProxy","dragHandler","dragcancelHandler","start","trigger","executeCallback","clone","append","removeAttr","css","position","keyCode","clickedElement","displayMoveDialogue","getPositionInNode","node","rect","getBoundingClientRect","scrollY","scrollX","width","height","xRatio","yRatio","isListHorizontal","document","elementFromPoint","current","currentList","isNotProxy","filter","find","coordinates","ratio","subList","currentElement","isNotCurrent","subListEmpty","endX","endY","endTime","parentElement","beforeElement","dragEl","insertBefore","appendChild","stop","off","eventName","getElementName","Deferred","resolve","text","getDestinationName","afterElement","get_string","then","name","getMoveDialogueTitle","getDestinationsList","addedLists","targets","destinations","result","when","createLink","is","contains","txt","li","appendTo","a","attr","data","addList","inArray","push","list","each","prev","last","create","types","CANCEL","title","body","modal","quickMoveHandler","e","focus","hide","getRoot","hidden","destroy","setLarge","show","catch","exception"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * A javascript module to handle list items drag and drop\r\n *\r\n * Example of usage:\r\n *\r\n * define(['jquery', 'core/sortable_list'], function($, SortableList) {\r\n *     var list = new SortableList('ul.my-awesome-list', // source list (usually <ul> or <tbody>) - selector or element\r\n *         {\r\n *             moveHandlerSelector: '.draghandle'  // CSS selector of the crossarrow handle. Make sure that this\r\n *               // element can handle keypress and mouse click events for displaying accessible move popup.\r\n *         });\r\n *     $('ul.my-awesome-list > *').on(SortableList.EVENTS.DROP, function(evt, info) {\r\n *         console.log(info);\r\n *     });\r\n *\r\n *     // Advanced usage. Overwrite methods getElementName, getDestinationName, moveDialogueTitle, for example:\r\n *     list.getElementName = function(element) {\r\n *         return $.Deferred().resolve(element.attr('data-name'));\r\n *     }\r\n * }\r\n *\r\n * More details: https://docs.moodle.org/dev/Sortable_list\r\n *\r\n * For the full list of possible parameters see var defaultParameters below.\r\n *\r\n * The following jQuery events are fired:\r\n * - SortableList.EVENTS.DRAGSTART : when user started dragging a list element\r\n * - SortableList.EVENTS.DRAG : when user dragged a list element to a new position\r\n * - SortableList.EVENTS.DROP : when user dropped a list element\r\n * - SortableList.EVENTS.DROPEND : when user finished dragging - either fired right after dropping or\r\n *                          if \"Esc\" was pressed during dragging\r\n *\r\n * @module     core/sortable_list\r\n * @class      sortable_list\r\n * @package    core\r\n * @copyright  2018 Marina Glancy\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n define(['jquery', 'core/log', 'core/autoscroll', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/notification'],\r\n function($, log, autoScroll, str, ModalFactory, ModalEvents, Notification) {\r\n     /**\r\n      * Default parameters\r\n      *\r\n      * @private\r\n      * @type {Object}\r\n      */\r\n     var defaultParameters = {\r\n         targetListSelector: null,\r\n         moveHandlerSelector: null,\r\n         isHorizontal: false,\r\n         autoScroll: true\r\n     };\r\n\r\n     /**\r\n      * Class names for different elements that may be changed during sorting\r\n      *\r\n      * @private\r\n      * @type {Object}\r\n      */\r\n     var CSS = {\r\n         keyboardDragClass: 'dragdrop-keyboard-drag',\r\n         isDraggedClass: 'sortable-list-is-dragged',\r\n         currentPositionClass: 'sortable-list-current-position',\r\n         sourceListClass: 'sortable-list-source',\r\n         targetListClass: 'sortable-list-target',\r\n         overElementClass: 'sortable-list-over-element'\r\n     };\r\n\r\n     /**\r\n      * Allow to create non-passive touchstart listeners and prevent page scrolling when dragging\r\n      * From: https://stackoverflow.com/a/48098097\r\n      *\r\n      * @type {Object}\r\n      */\r\n     $.event.special.touchstart = {\r\n         setup: function(_, ns, handle) {\r\n             if (ns.includes('notPassive')) {\r\n                 this.addEventListener('touchstart', handle, {passive: false});\r\n                 return true;\r\n             } else {\r\n                 return false;\r\n             }\r\n         }\r\n     };\r\n\r\n     /**\r\n      * Initialise sortable list.\r\n      *\r\n      * @param {(String|jQuery|Element)} root JQuery/DOM element representing sortable list (i.e. <ul>, <tbody>) or CSS selector\r\n      * @param {Object} config Parameters for the list. See defaultParameters above for examples.\r\n      * @property {(String|jQuery|Element)} config.targetListSelector target lists, by default same as root\r\n      * @property {String} config.moveHandlerSelector  CSS selector for a drag handle. By default the whole item is a handle.\r\n      *                                                Without drag handle sorting is not accessible!\r\n      * @property {String} config.targetListSelector   CSS selector for target lists. By default the same as root\r\n      * @property {(Boolean|Function)} config.isHorizontal Set to true if the list is horizontal\r\n      *                                                (can also be a callback with list as an argument)\r\n      * @property {Boolean} config.autoScroll          Engages autoscroll module for automatic vertical scrolling of the\r\n      *                                                whole page, by default true\r\n      */\r\n     var SortableList = function(root, config) {\r\n\r\n         this.info = null;\r\n         this.proxy = null;\r\n         this.proxyDelta = null;\r\n         this.dragCounter = 0;\r\n         this.lastEvent = null;\r\n         this.moved = false;\r\n\r\n         this.config = $.extend({}, defaultParameters, config || {});\r\n         this.config.listSelector = root;\r\n         if (!this.config.targetListSelector) {\r\n             this.config.targetListSelector = root;\r\n         }\r\n         if (typeof this.config.listSelector === 'object') {\r\n             // The root is an element on the page. Register a listener for this element.\r\n             $(this.config.listSelector).on('mousedown touchstart.notPassive', $.proxy(this.dragStartHandler, this));\r\n         } else {\r\n             // The root is a CSS selector. Register a listener that picks up the element dynamically.\r\n             $('body').on('mousedown touchstart.notPassive', this.config.listSelector, $.proxy(this.dragStartHandler, this));\r\n         }\r\n         if (this.config.moveHandlerSelector !== null) {\r\n             $('body').on('click keypress', this.config.moveHandlerSelector, $.proxy(this.clickHandler, this));\r\n         }\r\n\r\n     };\r\n\r\n     /**\r\n      * Events fired by this entity\r\n      *\r\n      * @public\r\n      * @type {Object}\r\n      */\r\n     SortableList.EVENTS = {\r\n         DRAGSTART: 'sortablelist-dragstart',\r\n         DRAG: 'sortablelist-drag',\r\n         DROP: 'sortablelist-drop',\r\n         DRAGEND: 'sortablelist-dragend'\r\n     };\r\n\r\n     /**\r\n      * Resets the temporary classes assigned during dragging\r\n      * @private\r\n      */\r\n      SortableList.prototype.resetDraggedClasses = function() {\r\n         var classes = [\r\n             CSS.isDraggedClass,\r\n             CSS.currentPositionClass,\r\n             CSS.overElementClass,\r\n             CSS.targetListClass,\r\n         ];\r\n         for (var i in classes) {\r\n             $('.' + classes[i]).removeClass(classes[i]);\r\n         }\r\n         if (this.proxy) {\r\n             this.proxy.remove();\r\n             this.proxy = $();\r\n         }\r\n     };\r\n\r\n     /**\r\n      * Calculates evt.pageX, evt.pageY, evt.clientX and evt.clientY\r\n      *\r\n      * For touch events pageX and pageY are taken from the first touch;\r\n      * For the emulated mousemove event they are taken from the last real event.\r\n      *\r\n      * @private\r\n      * @param {Event} evt\r\n      */\r\n     SortableList.prototype.calculatePositionOnPage = function(evt) {\r\n\r\n         if (evt.originalEvent && evt.originalEvent.touches && evt.originalEvent.touches[0] !== undefined) {\r\n             // This is a touchmove or touchstart event, get position from the first touch position.\r\n             var touch = evt.originalEvent.touches[0];\r\n             evt.pageX = touch.pageX;\r\n             evt.pageY = touch.pageY;\r\n         }\r\n\r\n         if (evt.pageX === undefined) {\r\n             // Information is not present in case of touchend or when event was emulated by autoScroll.\r\n             // Take the absolute mouse position from the last event.\r\n             evt.pageX = this.lastEvent.pageX;\r\n             evt.pageY = this.lastEvent.pageY;\r\n         } else {\r\n             this.lastEvent = evt;\r\n         }\r\n\r\n         if (evt.clientX === undefined) {\r\n             // If not provided in event calculate relative mouse position.\r\n             evt.clientX = Math.round(evt.pageX - $(window).scrollLeft());\r\n             evt.clientY = Math.round(evt.pageY - $(window).scrollTop());\r\n         }\r\n     };\r\n\r\n     /**\r\n      * Handler from dragstart event\r\n      *\r\n      * @private\r\n      * @param {Event} evt\r\n      */\r\n     SortableList.prototype.dragStartHandler = function(evt) {\r\n         if (this.info !== null) {\r\n             if (this.info.type === 'click') {\r\n                 // Ignore double click.\r\n                 return;\r\n             }\r\n             // Mouse down or touch while already dragging, cancel previous dragging.\r\n             this.moveElement(this.info.sourceList, this.info.sourceNextElement);\r\n             this.finishDragging();\r\n         }\r\n\r\n         if (evt.type === 'mousedown' && evt.which !== 1) {\r\n             // We only need left mouse click. If this is a mousedown event with right/middle click ignore it.\r\n             return;\r\n         }\r\n\r\n         this.calculatePositionOnPage(evt);\r\n         var movedElement = $(evt.target).closest($(evt.currentTarget).children());\r\n         if (!movedElement.length) {\r\n             // Can't find the element user wants to drag. They clicked on the list but outside of any element of the list.\r\n             return;\r\n         }\r\n\r\n         // Check that we grabbed the element by the handle.\r\n         if (this.config.moveHandlerSelector !== null) {\r\n             if (!$(evt.target).closest(this.config.moveHandlerSelector, movedElement).length) {\r\n                 return;\r\n             }\r\n         }\r\n\r\n         evt.stopPropagation();\r\n         evt.preventDefault();\r\n\r\n         // Information about moved element with original location.\r\n         // This object is passed to event observers.\r\n         this.dragCounter++;\r\n         this.moved = false;\r\n         this.info = {\r\n             element: movedElement,\r\n             sourceNextElement: movedElement.next(),\r\n             sourceList: movedElement.parent(),\r\n             targetNextElement: movedElement.next(),\r\n             targetList: movedElement.parent(),\r\n             type: evt.type,\r\n             dropped: false,\r\n             startX: evt.pageX,\r\n             startY: evt.pageY,\r\n             startTime: new Date().getTime()\r\n         };\r\n\r\n         $(this.config.targetListSelector).addClass(CSS.targetListClass);\r\n\r\n         var offset = movedElement.offset();\r\n         movedElement.addClass(CSS.currentPositionClass);\r\n         this.proxyDelta = {x: offset.left - evt.pageX, y: offset.top - evt.pageY};\r\n         this.proxy = $();\r\n         var thisDragCounter = this.dragCounter;\r\n         setTimeout($.proxy(function() {\r\n             // This mousedown event may in fact be a beginning of a 'click' event. Use timeout before showing the\r\n             // dragged object so we can catch click event. When timeout finishes make sure that click event\r\n             // has not happened during this half a second.\r\n             // Verify dragcounter to make sure the user did not manage to do two very fast drag actions one after another.\r\n             if (this.info === null || this.info.type === 'click' || this.info.type === 'keypress'\r\n                     || this.dragCounter !== thisDragCounter) {\r\n                 return;\r\n             }\r\n\r\n             // Create a proxy - the copy of the dragged element that moves together with a mouse.\r\n             this.createProxy();\r\n         }, this), 500);\r\n\r\n         // Start drag.\r\n         $(window).on('mousemove touchmove mouseup touchend', $.proxy(this.dragHandler, this));\r\n         $(window).on('keypress', $.proxy(this.dragcancelHandler, this));\r\n\r\n         // Start autoscrolling. Every time the page is scrolled emulate the mousemove event.\r\n         if (this.config.autoScroll) {\r\n             autoScroll.start(function() {\r\n                 $(window).trigger('mousemove');\r\n             });\r\n         }\r\n\r\n        this.executeCallback(SortableList.EVENTS.DRAGSTART);\r\n     };\r\n\r\n     /**\r\n      * Creates a \"proxy\" object - a copy of the element that is being moved that always follows the mouse\r\n      * @private\r\n      */\r\n     SortableList.prototype.createProxy = function() {\r\n         this.proxy = this.info.element.clone();\r\n         this.info.sourceList.append(this.proxy);\r\n         this.proxy.removeAttr('id').removeClass(CSS.currentPositionClass)\r\n             .addClass(CSS.isDraggedClass).css({position: 'fixed'});\r\n         this.proxy.offset({top: this.proxyDelta.y + this.lastEvent.pageY, left: this.proxyDelta.x + this.lastEvent.pageX});\r\n     };\r\n\r\n     /**\r\n      * Handler for click event - when user clicks on the drag handler or presses Enter on keyboard\r\n      *\r\n      * @private\r\n      * @param {Event} evt\r\n      */\r\n     SortableList.prototype.clickHandler = function(evt) {\r\n         if (evt.type === 'keypress' && evt.originalEvent.keyCode !== 13 && evt.originalEvent.keyCode !== 32) {\r\n             return;\r\n         }\r\n         if (this.info !== null && this.info.type === 'click') {\r\n             // Ignore double click.\r\n             return;\r\n         }\r\n         evt.preventDefault();\r\n         evt.stopPropagation();\r\n\r\n         // Find the element that this draghandle belongs to.\r\n         var clickedElement = $(evt.target).closest(this.config.moveHandlerSelector),\r\n             sourceList = clickedElement.closest(this.config.listSelector),\r\n             movedElement = clickedElement.closest(sourceList.children());\r\n         if (!movedElement.length) {\r\n             return;\r\n         }\r\n\r\n         // Store information about moved element with original location.\r\n         this.dragCounter++;\r\n         this.info = {\r\n             element: movedElement,\r\n             sourceNextElement: movedElement.next(),\r\n             sourceList: sourceList,\r\n             targetNextElement: movedElement.next(),\r\n             targetList: sourceList,\r\n             dropped: false,\r\n             type: evt.type,\r\n             startTime: new Date().getTime()\r\n         };\r\n\r\n         this.executeCallback(SortableList.EVENTS.DRAGSTART);\r\n         this.displayMoveDialogue(clickedElement);\r\n     };\r\n\r\n     /**\r\n      * Finds the position of the mouse inside the element - on the top, on the bottom, on the right or on the left\\\r\n      *\r\n      * Used to determine if the moved element should be moved after or before the current element\r\n      *\r\n      * @private\r\n      * @param {Number} pageX\r\n      * @param {Number} pageY\r\n      * @param {jQuery} element\r\n      * @returns {(Object|null)}\r\n      */\r\n     SortableList.prototype.getPositionInNode = function(pageX, pageY, element) {\r\n         if (!element.length) {\r\n             return null;\r\n         }\r\n         var node = element[0],\r\n             offset = 0,\r\n             rect = node.getBoundingClientRect(),\r\n             y = pageY - (rect.top + window.scrollY),\r\n             x = pageX - (rect.left + window.scrollX);\r\n         if (x >= -offset && x <= rect.width + offset && y >= -offset && y <= rect.height + offset) {\r\n             return {\r\n                 x: x,\r\n                 y: y,\r\n                 xRatio: rect.width ? (x / rect.width) : 0,\r\n                 yRatio: rect.height ? (y / rect.height) : 0\r\n             };\r\n         }\r\n         return null;\r\n     };\r\n\r\n     /**\r\n      * Check if list is horizontal\r\n      *\r\n      * @param {jQuery} element\r\n      * @return {Boolean}\r\n      */\r\n     SortableList.prototype.isListHorizontal = function(element) {\r\n         var isHorizontal = this.config.isHorizontal;\r\n         if (isHorizontal === true || isHorizontal === false) {\r\n             return isHorizontal;\r\n         }\r\n         return isHorizontal(element);\r\n     };\r\n\r\n     /**\r\n      * Handler for events mousemove touchmove mouseup touchend\r\n      *\r\n      * @private\r\n      * @param {Event} evt\r\n      */\r\n     SortableList.prototype.dragHandler = function(evt) {\r\n\r\n         this.calculatePositionOnPage(evt);\r\n\r\n         // We can not use evt.target here because it will most likely be our proxy.\r\n         // Move the proxy out of the way so we can find the element at the current mouse position.\r\n         this.proxy.offset({top: -1000, left: -1000});\r\n         // Find the element at the current mouse position.\r\n         var element = $(document.elementFromPoint(evt.clientX, evt.clientY));\r\n\r\n         // Find the list element and the list over the mouse position.\r\n         var current = element.closest('.' + CSS.targetListClass + ' > :not(.' + CSS.isDraggedClass + ')'),\r\n             currentList = element.closest('.' + CSS.targetListClass),\r\n             proxy = this.proxy,\r\n             isNotProxy = function() {\r\n                 return !proxy || !proxy.length || this !== proxy[0];\r\n             };\r\n\r\n         // Add the specified class to the list element we are hovering.\r\n         $('.' + CSS.overElementClass).removeClass(CSS.overElementClass);\r\n         current.addClass(CSS.overElementClass);\r\n\r\n         // Move proxy to the current position.\r\n         this.proxy.offset({top: this.proxyDelta.y + evt.pageY, left: this.proxyDelta.x + evt.pageX});\r\n\r\n         if (currentList.length && !currentList.children().filter(isNotProxy).length) {\r\n             // Mouse is over an empty list.\r\n             this.moveElement(currentList, $());\r\n         } else if (current.length === 1 && !this.info.element.find(current[0]).length) {\r\n             // Mouse is over an element in a list - find whether we should move the current position\r\n             // above or below this element.\r\n             var coordinates = this.getPositionInNode(evt.pageX, evt.pageY, current);\r\n             if (coordinates) {\r\n                 var parent = current.parent(),\r\n                     ratio = this.isListHorizontal(parent) ? coordinates.xRatio : coordinates.yRatio,\r\n                     subList = current.find('.' + CSS.targetListClass),\r\n                     currentElement = this.info.element[0],\r\n                     isNotCurrent = function() {\r\n                         return this !== currentElement;\r\n                     },\r\n                     subListEmpty = !subList.children().filter(isNotProxy).filter(isNotCurrent).length;\r\n                 if (subList.length && subListEmpty && ratio > 0.2 && ratio < 0.8) {\r\n                     // This is an element that is a parent of an empty list and we are around the middle of this element.\r\n                     // Treat it as if we are over this empty list.\r\n                    this.moveElement(subList, $());\r\n                 } else if (ratio > 0.5) {\r\n                     // Insert after this element.\r\n                    this.moveElement(parent, current.next().filter(isNotProxy));\r\n                 } else {\r\n                     // Insert before this element.\r\n                    this.moveElement(parent, current);\r\n                 }\r\n             }\r\n         }\r\n\r\n         if (evt.type === 'mouseup' || evt.type === 'touchend') {\r\n             // Drop the moved element.\r\n             this.info.endX = evt.pageX;\r\n             this.info.endY = evt.pageY;\r\n             this.info.endTime = new Date().getTime();\r\n             this.info.dropped = true;\r\n             this.executeCallback(SortableList.EVENTS.DROP);\r\n             this.finishDragging();\r\n         } else {\r\n             this.moved = true;\r\n         }\r\n\r\n         if (evt.type === 'touchend' && !this.moved) {\r\n             // The click event is not triggered on touch screens because we call preventDefault in touchstart handler.\r\n             // If the touchend followed touchstart without touchmove between them, consider it a \"click\".\r\n             this.clickHandler(evt);\r\n         }\r\n     };\r\n\r\n     /**\r\n      * Moves the current position of the dragged element\r\n      *\r\n      * @private\r\n      * @param {jQuery} parentElement\r\n      * @param {jQuery} beforeElement\r\n      */\r\n     SortableList.prototype.moveElement = function(parentElement, beforeElement) {\r\n         var dragEl = this.info.element;\r\n         if (beforeElement.length && beforeElement[0] === dragEl[0]) {\r\n             // Insert before the current position of the dragged element - nothing to do.\r\n             return;\r\n         }\r\n         if (parentElement[0] === this.info.targetList[0] &&\r\n                 beforeElement.length === this.info.targetNextElement.length &&\r\n                 beforeElement[0] === this.info.targetNextElement[0]) {\r\n             // Insert in the same location as the current position - nothing to do.\r\n             return;\r\n         }\r\n\r\n         if (beforeElement.length) {\r\n             // Move the dragged element before the specified element.\r\n             parentElement[0].insertBefore(dragEl[0], beforeElement[0]);\r\n         } else if (this.proxy && this.proxy.parent().length && this.proxy.parent()[0] === parentElement[0]) {\r\n             // We need to move to the end of the list but the last element in this list is a proxy.\r\n             // Always leave the proxy in the end of the list.\r\n             parentElement[0].insertBefore(dragEl[0], this.proxy[0]);\r\n         } else {\r\n             // Insert in the end of a list (when proxy is in another list).\r\n             parentElement[0].appendChild(dragEl[0]);\r\n         }\r\n\r\n         // Save the current position of the dragged element in the list.\r\n         this.info.targetList = parentElement;\r\n         this.info.targetNextElement = beforeElement;\r\n         this.executeCallback(SortableList.EVENTS.DRAG);\r\n     };\r\n\r\n     /**\r\n      * Finish dragging (when dropped or cancelled).\r\n      * @private\r\n      */\r\n     SortableList.prototype.finishDragging = function() {\r\n         this.resetDraggedClasses();\r\n         if (this.config.autoScroll) {\r\n             autoScroll.stop();\r\n         }\r\n         $(window).off('mousemove touchmove mouseup touchend', $.proxy(this.dragHandler, this));\r\n         $(window).off('keypress', $.proxy(this.dragcancelHandler, this));\r\n         this.executeCallback(SortableList.EVENTS.DRAGEND);\r\n         this.info = null;\r\n     };\r\n\r\n     /**\r\n      * Executes callback specified in sortable list parameters\r\n      *\r\n      * @private\r\n      * @param {String} eventName\r\n      */\r\n     SortableList.prototype.executeCallback = function(eventName) {\r\n         this.info.element.trigger(eventName, this.info);\r\n     };\r\n\r\n     /**\r\n      * Handler from keypress event (cancel dragging when Esc is pressed)\r\n      *\r\n      * @private\r\n      * @param {Event} evt\r\n      */\r\n     SortableList.prototype.dragcancelHandler = function(evt) {\r\n         if (evt.type !== 'keypress' || evt.originalEvent.keyCode !== 27) {\r\n             // Only cancel dragging when Esc was pressed.\r\n             return;\r\n         }\r\n         // Dragging was cancelled. Return item to the original position.\r\n         this.moveElement(this.info.sourceList, this.info.sourceNextElement);\r\n         this.finishDragging();\r\n     };\r\n\r\n     /**\r\n      * Returns the name of the current element to be used in the move dialogue\r\n      *\r\n      * @public\r\n      * @param {jQuery} element\r\n      * @return {Promise}\r\n      */\r\n     SortableList.prototype.getElementName = function(element) {\r\n         return $.Deferred().resolve(element.text());\r\n     };\r\n\r\n     /**\r\n      * Returns the label for the potential move destination, i.e. \"After ElementX\" or \"To the top of the list\"\r\n      *\r\n      * Note that we use \"after\" in the label for better UX\r\n      *\r\n      * @public\r\n      * @param {jQuery} parentElement\r\n      * @param {jQuery} afterElement\r\n      * @return {Promise}\r\n      */\r\n     SortableList.prototype.getDestinationName = function(parentElement, afterElement) {\r\n         if (!afterElement.length) {\r\n             return str.get_string('movecontenttothetop', 'moodle');\r\n         } else {\r\n             return this.getElementName(afterElement)\r\n                 .then(function(name) {\r\n                     return str.get_string('movecontentafter', 'moodle', name);\r\n                 });\r\n         }\r\n     };\r\n\r\n     /**\r\n      * Returns the title for the move dialogue (\"Move elementY\")\r\n      *\r\n      * @public\r\n      * @param {jQuery} element\r\n      * @return {Promise}\r\n      */\r\n     SortableList.prototype.getMoveDialogueTitle = function(element) {\r\n         return this.getElementName(element).then(function(name) {\r\n             return str.get_string('movecontent', 'moodle', name);\r\n         });\r\n     };\r\n\r\n     /**\r\n      * Returns the list of possible move destinations\r\n      *\r\n      * @private\r\n      * @return {Promise}\r\n      */\r\n     SortableList.prototype.getDestinationsList = function() {\r\n         var addedLists = [],\r\n             targets = $(this.config.targetListSelector),\r\n             destinations = $('<ul/>').addClass(CSS.keyboardDragClass),\r\n             result = $.when().then(function() {\r\n                 return destinations;\r\n             }),\r\n             createLink = $.proxy(function(parentElement, beforeElement, afterElement) {\r\n                 if (beforeElement.is(this.info.element) || afterElement.is(this.info.element)) {\r\n                     // Can not move before or after itself.\r\n                     return;\r\n                 }\r\n                 if ($.contains(this.info.element[0], parentElement[0])) {\r\n                     // Can not move to its own child.\r\n                     return;\r\n                 }\r\n                 result = result\r\n                 .then($.proxy(function() {\r\n                     return this.getDestinationName(parentElement, afterElement);\r\n                 }, this))\r\n                 .then(function(txt) {\r\n                     var li = $('<li/>').appendTo(destinations);\r\n                     var a = $('<a href=\"#\"/>').attr('data-core_sortable_list-quickmove', 1).appendTo(li);\r\n                     a.data('parent-element', parentElement).data('before-element', beforeElement).text(txt);\r\n                     return destinations;\r\n                 });\r\n             }, this),\r\n             addList = function() {\r\n                 // Destination lists may be nested. We want to add all move destinations in the same\r\n                 // order they appear on the screen for the user.\r\n                 if ($.inArray(this, addedLists) !== -1) {\r\n                     return;\r\n                 }\r\n                 addedLists.push(this);\r\n                 var list = $(this),\r\n                     children = list.children();\r\n                 children.each(function() {\r\n                     var element = $(this);\r\n                     createLink(list, element, element.prev());\r\n                     // Add all nested lists.\r\n                     element.find(targets).each(addList);\r\n                 });\r\n                 createLink(list, $(), children.last());\r\n             };\r\n         targets.each(addList);\r\n         return result;\r\n     };\r\n\r\n     /**\r\n      * Displays the dialogue to move element.\r\n      * @param {jQuery} clickedElement element to return focus to after the modal is closed\r\n      * @private\r\n      */\r\n     SortableList.prototype.displayMoveDialogue = function(clickedElement) {\r\n         ModalFactory.create({\r\n             type: ModalFactory.types.CANCEL,\r\n             title: this.getMoveDialogueTitle(this.info.element),\r\n             body: this.getDestinationsList()\r\n         }).then($.proxy(function(modal) {\r\n             var quickMoveHandler = $.proxy(function(e) {\r\n                 e.preventDefault();\r\n                 e.stopPropagation();\r\n                 this.moveElement($(e.currentTarget).data('parent-element'), $(e.currentTarget).data('before-element'));\r\n                 this.info.endTime = new Date().getTime();\r\n                 this.info.dropped = true;\r\n                 clickedElement.focus();\r\n                 this.executeCallback(SortableList.EVENTS.DROP);\r\n                 modal.hide();\r\n             }, this);\r\n             modal.getRoot().on('click', '[data-core_sortable_list-quickmove]', quickMoveHandler);\r\n             modal.getRoot().on(ModalEvents.hidden, $.proxy(function() {\r\n                 // Always destroy when hidden, it is generated dynamically each time.\r\n                 modal.getRoot().off('click', '[data-core_sortable_list-quickmove]', quickMoveHandler);\r\n                 modal.destroy();\r\n                 this.finishDragging();\r\n             }, this));\r\n             modal.setLarge();\r\n             modal.show();\r\n             return modal;\r\n         }, this)).catch(Notification.exception);\r\n     };\r\n\r\n     return SortableList;\r\n\r\n });"],"file":"sortable_list.min.js"}