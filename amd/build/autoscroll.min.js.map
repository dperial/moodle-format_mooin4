{"version":3,"sources":["../src/autoscroll.js"],"names":["define","$","autoscroll","SCROLL_THRESHOLD","SCROLL_FREQUENCY","SCROLL_SPEED","scrollingId","scrollAmount","callback","start","window","on","mouseMove","touchMove","stop","off","stopScrolling","e","i","changedTouches","length","handleMove","clientX","clientY","Math","min","height","startScrolling","maxScroll","document","setInterval","y","scrollTop","offset","round","realOffset","clearInterval"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/*\r\n * JavaScript to provide automatic scrolling, e.g. during a drag operation.\r\n *\r\n * Note: this module is defined statically. It is a singleton. You\r\n * can only have one use of it active at any time. However, since this\r\n * is usually used in relation to drag-drop, and since you only ever\r\n * drag one thing at a time, this is not a problem in practice.\r\n *\r\n * @module     core/autoscroll\r\n * @class      autoscroll\r\n * @package    core\r\n * @copyright  2016 The Open University\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n * @since      3.6\r\n */\r\ndefine(['jquery'], function($) {\r\n    /**\r\n     * @alias module:core/autoscroll\r\n     */\r\n    var autoscroll = {\r\n        /**\r\n         * Size of area near edge of screen that triggers scrolling.\r\n         * @private\r\n         */\r\n        SCROLL_THRESHOLD: 30,\r\n\r\n        /**\r\n         * How frequently to scroll window.\r\n         * @private\r\n         */\r\n        SCROLL_FREQUENCY: 1000 / 60,\r\n\r\n        /**\r\n         * How many pixels to scroll per unit (1 = max scroll 30).\r\n         * @private\r\n         */\r\n        SCROLL_SPEED: 0.5,\r\n\r\n        /**\r\n         * Set if currently scrolling up/down.\r\n         * @private\r\n         */\r\n        scrollingId: null,\r\n\r\n        /**\r\n         * Speed we are supposed to scroll (range 1 to SCROLL_THRESHOLD).\r\n         * @private\r\n         */\r\n        scrollAmount: 0,\r\n\r\n        /**\r\n         * Optional callback called when it scrolls\r\n         * @private\r\n         */\r\n        callback: null,\r\n\r\n        /**\r\n         * Starts automatically scrolling if user moves near edge of window.\r\n         * This should be called in response to mouse down or touch start.\r\n         *\r\n         * @public\r\n         * @param {Function} callback Optional callback that is called every time it scrolls\r\n         */\r\n        start: function(callback) {\r\n            $(window).on('mousemove', autoscroll.mouseMove);\r\n            $(window).on('touchmove', autoscroll.touchMove);\r\n            autoscroll.callback = callback;\r\n        },\r\n\r\n        /**\r\n         * Stops automatically scrolling. This should be called in response to mouse up or touch end.\r\n         *\r\n         * @public\r\n         */\r\n        stop: function() {\r\n            $(window).off('mousemove', autoscroll.mouseMove);\r\n            $(window).off('touchmove', autoscroll.touchMove);\r\n            if (autoscroll.scrollingId !== null) {\r\n                autoscroll.stopScrolling();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Event handler for touch move.\r\n         *\r\n         * @private\r\n         * @param {Object} e Event\r\n         */\r\n        touchMove: function(e) {\r\n            for (var i = 0; i < e.changedTouches.length; i++) {\r\n                autoscroll.handleMove(e.changedTouches[i].clientX, e.changedTouches[i].clientY);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Event handler for mouse move.\r\n         *\r\n         * @private\r\n         * @param {Object} e Event\r\n         */\r\n        mouseMove: function(e) {\r\n            autoscroll.handleMove(e.clientX, e.clientY);\r\n        },\r\n\r\n        /**\r\n         * Handles user moving.\r\n         *\r\n         * @private\r\n         * @param {number} clientX X\r\n         * @param {number} clientY Y\r\n         */\r\n        handleMove: function(clientX, clientY) {\r\n            // If near the bottom or top, start auto-scrolling.\r\n            if (clientY < autoscroll.SCROLL_THRESHOLD) {\r\n                autoscroll.scrollAmount = -Math.min(autoscroll.SCROLL_THRESHOLD - clientY, autoscroll.SCROLL_THRESHOLD);\r\n            } else if (clientY > $(window).height() - autoscroll.SCROLL_THRESHOLD) {\r\n                autoscroll.scrollAmount = Math.min(clientY - ($(window).height() - autoscroll.SCROLL_THRESHOLD),\r\n                    autoscroll.SCROLL_THRESHOLD);\r\n            } else {\r\n                autoscroll.scrollAmount = 0;\r\n            }\r\n            if (autoscroll.scrollAmount && autoscroll.scrollingId === null) {\r\n                autoscroll.startScrolling();\r\n            } else if (!autoscroll.scrollAmount && autoscroll.scrollingId !== null) {\r\n                autoscroll.stopScrolling();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Starts automatic scrolling.\r\n         *\r\n         * @private\r\n         */\r\n        startScrolling: function() {\r\n            var maxScroll = $(document).height - $(window).height;\r\n            autoscroll.scrollingId = window.setInterval(function() {\r\n                // Work out how much to scroll.\r\n                var y = $(window).scrollTop();\r\n                var offset = Math.round(autoscroll.scrollAmount * autoscroll.SCROLL_SPEED);\r\n                if (y + offset < 0) {\r\n                    offset = -y;\r\n                }\r\n                if (y + offset > maxScroll) {\r\n                    offset = maxScroll - y;\r\n                }\r\n                if (offset === 0) {\r\n                    return;\r\n                }\r\n\r\n                // Scroll.\r\n                $(window).scrollTop(y + offset);\r\n                var realOffset = $(window).scrollTop() - y;\r\n                if (realOffset === 0) {\r\n                    return;\r\n                }\r\n\r\n                // Inform callback\r\n                if (autoscroll.callback) {\r\n                    autoscroll.callback(realOffset);\r\n                }\r\n\r\n            }, autoscroll.SCROLL_FREQUENCY);\r\n        },\r\n\r\n        /**\r\n         * Stops the automatic scrolling.\r\n         *\r\n         * @private\r\n         */\r\n        stopScrolling: function() {\r\n            window.clearInterval(autoscroll.scrollingId);\r\n            autoscroll.scrollingId = null;\r\n        }\r\n    };\r\n\r\n    return {\r\n        /**\r\n         * Starts automatic scrolling if user moves near edge of window.\r\n         * This should be called in response to mouse down or touch start.\r\n         *\r\n         * @public\r\n         * @param {Function} callback Optional callback that is called every time it scrolls\r\n         */\r\n        start: autoscroll.start,\r\n\r\n        /**\r\n         * Stops automatic scrolling. This should be called in response to mouse up or touch end.\r\n         *\r\n         * @public\r\n         */\r\n        stop: autoscroll.stop,\r\n    };\r\n\r\n});"],"file":"autoscroll.min.js"}