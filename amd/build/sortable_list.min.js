function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("format_mooin4/sortable_list",["jquery","core/log","core/autoscroll","core/str","core/modal_factory","core/modal_events","core/notification"],function(b,a,c,d,e,f,g){var h={targetListSelector:null,moveHandlerSelector:null,isHorizontal:!1,autoScroll:!0},j={keyboardDragClass:"dragdrop-keyboard-drag",isDraggedClass:"sortable-list-is-dragged",currentPositionClass:"sortable-list-current-position",sourceListClass:"sortable-list-source",targetListClass:"sortable-list-target",overElementClass:"sortable-list-over-element"};b.event.special.touchstart={setup:function setup(a,b,c){if(b.includes("notPassive")){this.addEventListener("touchstart",c,{passive:!1});return!0}else{return!1}}};var k=function(a,c){this.info=null;this.proxy=null;this.proxyDelta=null;this.dragCounter=0;this.lastEvent=null;this.moved=!1;this.config=b.extend({},h,c||{});this.config.listSelector=a;if(!this.config.targetListSelector){this.config.targetListSelector=a}if("object"===_typeof(this.config.listSelector)){b(this.config.listSelector).on("mousedown touchstart.notPassive",b.proxy(this.dragStartHandler,this))}else{b("body").on("mousedown touchstart.notPassive",this.config.listSelector,b.proxy(this.dragStartHandler,this))}if(null!==this.config.moveHandlerSelector){b("body").on("click keypress",this.config.moveHandlerSelector,b.proxy(this.clickHandler,this))}};k.EVENTS={DRAGSTART:"sortablelist-dragstart",DRAG:"sortablelist-drag",DROP:"sortablelist-drop",DRAGEND:"sortablelist-dragend"};k.prototype.resetDraggedClasses=function(){var a=[j.isDraggedClass,j.currentPositionClass,j.overElementClass,j.targetListClass];for(var c in a){b("."+a[c]).removeClass(a[c])}if(this.proxy){this.proxy.remove();this.proxy=b()}};k.prototype.calculatePositionOnPage=function(a){if(a.originalEvent&&a.originalEvent.touches&&a.originalEvent.touches[0]!==void 0){var c=a.originalEvent.touches[0];a.pageX=c.pageX;a.pageY=c.pageY}if(a.pageX===void 0){a.pageX=this.lastEvent.pageX;a.pageY=this.lastEvent.pageY}else{this.lastEvent=a}if(a.clientX===void 0){a.clientX=Math.round(a.pageX-b(window).scrollLeft());a.clientY=Math.round(a.pageY-b(window).scrollTop())}};k.prototype.dragStartHandler=function(a){if(null!==this.info){if("click"===this.info.type){return}this.moveElement(this.info.sourceList,this.info.sourceNextElement);this.finishDragging()}if("mousedown"===a.type&&1!==a.which){return}this.calculatePositionOnPage(a);var d=b(a.target).closest(b(a.currentTarget).children());if(!d.length){return}if(null!==this.config.moveHandlerSelector){if(!b(a.target).closest(this.config.moveHandlerSelector,d).length){return}}a.stopPropagation();a.preventDefault();this.dragCounter++;this.moved=!1;this.info={element:d,sourceNextElement:d.next(),sourceList:d.parent(),targetNextElement:d.next(),targetList:d.parent(),type:a.type,dropped:!1,startX:a.pageX,startY:a.pageY,startTime:new Date().getTime()};b(this.config.targetListSelector).addClass(j.targetListClass);var e=d.offset();d.addClass(j.currentPositionClass);this.proxyDelta={x:e.left-a.pageX,y:e.top-a.pageY};this.proxy=b();var f=this.dragCounter;setTimeout(b.proxy(function(){if(null===this.info||"click"===this.info.type||"keypress"===this.info.type||this.dragCounter!==f){return}this.createProxy()},this),500);b(window).on("mousemove touchmove mouseup touchend",b.proxy(this.dragHandler,this));b(window).on("keypress",b.proxy(this.dragcancelHandler,this));if(this.config.autoScroll){c.start(function(){b(window).trigger("mousemove")})}this.executeCallback(k.EVENTS.DRAGSTART)};k.prototype.createProxy=function(){this.proxy=this.info.element.clone();this.info.sourceList.append(this.proxy);this.proxy.removeAttr("id").removeClass(j.currentPositionClass).addClass(j.isDraggedClass).css({position:"fixed"});this.proxy.offset({top:this.proxyDelta.y+this.lastEvent.pageY,left:this.proxyDelta.x+this.lastEvent.pageX})};k.prototype.clickHandler=function(a){if("keypress"===a.type&&13!==a.originalEvent.keyCode&&32!==a.originalEvent.keyCode){return}if(null!==this.info&&"click"===this.info.type){return}a.preventDefault();a.stopPropagation();var c=b(a.target).closest(this.config.moveHandlerSelector),d=c.closest(this.config.listSelector),e=c.closest(d.children());if(!e.length){return}this.dragCounter++;this.info={element:e,sourceNextElement:e.next(),sourceList:d,targetNextElement:e.next(),targetList:d,dropped:!1,type:a.type,startTime:new Date().getTime()};this.executeCallback(k.EVENTS.DRAGSTART);this.displayMoveDialogue(c)};k.prototype.getPositionInNode=function(a,b,c){if(!c.length){return null}var d=c[0],e=d.getBoundingClientRect(),f=b-(e.top+window.scrollY),g=a-(e.left+window.scrollX);if(g>=-0&&g<=e.width+0&&f>=-0&&f<=e.height+0){return{x:g,y:f,xRatio:e.width?g/e.width:0,yRatio:e.height?f/e.height:0}}return null};k.prototype.isListHorizontal=function(a){var b=this.config.isHorizontal;if(!0===b||!1===b){return b}return b(a)};k.prototype.dragHandler=function(a){this.calculatePositionOnPage(a);this.proxy.offset({top:-1e3,left:-1e3});var c=b(document.elementFromPoint(a.clientX,a.clientY)),d=c.closest("."+j.targetListClass+" > :not(."+j.isDraggedClass+")"),e=c.closest("."+j.targetListClass),f=this.proxy,g=function(){return!f||!f.length||this!==f[0]};b("."+j.overElementClass).removeClass(j.overElementClass);d.addClass(j.overElementClass);this.proxy.offset({top:this.proxyDelta.y+a.pageY,left:this.proxyDelta.x+a.pageX});if(e.length&&!e.children().filter(g).length){this.moveElement(e,b())}else if(1===d.length&&!this.info.element.find(d[0]).length){var h=this.getPositionInNode(a.pageX,a.pageY,d);if(h){var i=d.parent(),l=this.isListHorizontal(i)?h.xRatio:h.yRatio,m=d.find("."+j.targetListClass),n=this.info.element[0],o=function(){return this!==n},p=!m.children().filter(g).filter(o).length;if(m.length&&p&&.2<l&&.8>l){this.moveElement(m,b())}else if(.5<l){this.moveElement(i,d.next().filter(g))}else{this.moveElement(i,d)}}}if("mouseup"===a.type||"touchend"===a.type){this.info.endX=a.pageX;this.info.endY=a.pageY;this.info.endTime=new Date().getTime();this.info.dropped=!0;this.executeCallback(k.EVENTS.DROP);this.finishDragging()}else{this.moved=!0}if("touchend"===a.type&&!this.moved){this.clickHandler(a)}};k.prototype.moveElement=function(a,b){var c=this.info.element;if(b.length&&b[0]===c[0]){return}if(a[0]===this.info.targetList[0]&&b.length===this.info.targetNextElement.length&&b[0]===this.info.targetNextElement[0]){return}if(b.length){a[0].insertBefore(c[0],b[0])}else if(this.proxy&&this.proxy.parent().length&&this.proxy.parent()[0]===a[0]){a[0].insertBefore(c[0],this.proxy[0])}else{a[0].appendChild(c[0])}this.info.targetList=a;this.info.targetNextElement=b;this.executeCallback(k.EVENTS.DRAG)};k.prototype.finishDragging=function(){this.resetDraggedClasses();if(this.config.autoScroll){c.stop()}b(window).off("mousemove touchmove mouseup touchend",b.proxy(this.dragHandler,this));b(window).off("keypress",b.proxy(this.dragcancelHandler,this));this.executeCallback(k.EVENTS.DRAGEND);this.info=null};k.prototype.executeCallback=function(a){this.info.element.trigger(a,this.info)};k.prototype.dragcancelHandler=function(a){if("keypress"!==a.type||27!==a.originalEvent.keyCode){return}this.moveElement(this.info.sourceList,this.info.sourceNextElement);this.finishDragging()};k.prototype.getElementName=function(a){return b.Deferred().resolve(a.text())};k.prototype.getDestinationName=function(a,b){if(!b.length){return d.get_string("movecontenttothetop","moodle")}else{return this.getElementName(b).then(function(a){return d.get_string("movecontentafter","moodle",a)})}};k.prototype.getMoveDialogueTitle=function(a){return this.getElementName(a).then(function(a){return d.get_string("movecontent","moodle",a)})};k.prototype.getDestinationsList=function(){var a=[],c=b(this.config.targetListSelector),d=b("<ul/>").addClass(j.keyboardDragClass),e=b.when().then(function(){return d}),f=b.proxy(function(c,f,g){if(f.is(this.info.element)||g.is(this.info.element)){return}if(b.contains(this.info.element[0],c[0])){return}e=e.then(b.proxy(function(){return this.getDestinationName(c,g)},this)).then(function(e){var g=b("<li/>").appendTo(d),h=b("<a href=\"#\"/>").attr("data-core_sortable_list-quickmove",1).appendTo(g);h.data("parent-element",c).data("before-element",f).text(e);return d})},this),g=function(){if(-1!==b.inArray(this,a)){return}a.push(this);var d=b(this),e=d.children();e.each(function(){var a=b(this);f(d,a,a.prev());a.find(c).each(g)});f(d,b(),e.last())};c.each(g);return e};k.prototype.displayMoveDialogue=function(a){e.create({type:e.types.CANCEL,title:this.getMoveDialogueTitle(this.info.element),body:this.getDestinationsList()}).then(b.proxy(function(c){var d=b.proxy(function(d){d.preventDefault();d.stopPropagation();this.moveElement(b(d.currentTarget).data("parent-element"),b(d.currentTarget).data("before-element"));this.info.endTime=new Date().getTime();this.info.dropped=!0;a.focus();this.executeCallback(k.EVENTS.DROP);c.hide()},this);c.getRoot().on("click","[data-core_sortable_list-quickmove]",d);c.getRoot().on(f.hidden,b.proxy(function(){c.getRoot().off("click","[data-core_sortable_list-quickmove]",d);c.destroy();this.finishDragging()},this));c.setLarge();c.show();return c},this)).catch(g.exception)};return k});
//# sourceMappingURL=sortable_list.min.js.map
